#!/bin/bash

# Output CSV file
output_file="pokemon_summary.csv"

# Write CSV header
echo "Name,Height(m),Weight(kg)" > "$output_file"

# Process each JSON file
for json_file in *.json; do
    # Skip if no json files exist
    [ -f "$json_file" ] || continue

    # Extract data using jq
    name=$(jq -r '.name' "$json_file")
    formatted_height=$(jq -r '.height/10' "$json_file")  # Convert to meters
    formatted_weight=$(jq -r '.weight/10' "$json_file")  # Convert to kilograms

    # Append to CSV
    echo "$name,$formatted_height,$formatted_weight" >> "$output_file"
done

# Calculate averages using awk
awk -F, '
NR > 1 {
    height_sum += $2
    weight_sum += $3
    count++
}
END {
    if (count > 0) {
        printf "\nAverage height: %.2f m\n", height_sum/count
        printf "Average weight: %.2f kg\n", weight_sum/count
    } else {
        print "No Pok√©mon data found for calculating averages"
    }
}
' "$output_file"